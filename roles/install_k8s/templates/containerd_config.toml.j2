# Containerd configuration generated by Ansible
version = 2

[plugins."io.containerd.grpc.v1.cri".containerd]
  [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
    runtime_type = "io.containerd.runc.v2"
    [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
      SystemdCgroup = true
{% if groups.get('gpu') and inventory_hostname in groups['gpu'] %}
  [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.nvidia]
    runtime_type = "io.containerd.runc.v2"
    privileged_without_host_devices = false
    [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.nvidia.options]
      BinaryName = "/usr/bin/nvidia-container-runtime"
{% endif %}

[plugins."io.containerd.grpc.v1.cri".registry.mirrors."{{ registry_host }}:{{ registry_port }}"]
  endpoint = ["http://{{ registry_host }}:{{ registry_port }}"]
